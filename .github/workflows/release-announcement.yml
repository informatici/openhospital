name: SourceForge Release Announcement

on:
  release:
    types: [published]
  push:
    branches:
      - mwithi-release-news-sf

jobs:
  post-release-announcement:
    runs-on: ubuntu-latest

    steps:
      - name: Check out the code
        uses: actions/checkout@v2

      - name: Create Release Announcement on SourceForge
        env:
          SOURCEFORGE_BEARER: ${{ secrets.SOURCEFORGE_BEARER }}
          GITHUB_REPOSITORY: ${{ github.repository }}
          RELEASE_NAME: ${{ github.event.release.name }}
          RELEASE_BODY: ${{ github.event.release.body }}
        run: |
          curl -X POST -H "Content-Type: application/x-www-form-urlencoded" \
                  -H "Authorization: Bearer $SOURCEFORGE_BEARER" \
                  -d "labels=release" \
                  -d "state=draft" \
                  -d "text=$RELEASE_BODY" \
                  -d "title=$RELEASE_NAME" \
                  "https://sourceforge.net/rest/p/openhospital/blog"
