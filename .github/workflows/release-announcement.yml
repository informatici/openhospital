name: SourceForge Release Announcement

on:
  release:
    types: [published]
  push:
    branches:
      - mwithi-release-news-sf

jobs:
  post-release-announcement:
    runs-on: ubuntu-latest

    steps:
      - name: Check out the code
        uses: actions/checkout@v2

      - name: Create Release Announcement on SourceForge
        env:
          SOURCEFORGE_BEARER: ${{ secrets.SOURCEFORGE_BEARER }}
          GITHUB_REPOSITORY: ${{ github.repository }}
          RELEASE_NAME: ${{ github.event.release.name }}
          RELEASE_BODY: ${{ github.event.release.body }}
        run: |
          curl --location 'https://sourceforge.net/rest/p/openhospital/blog' \
               --header 'Content-Type: application/x-www-form-urlencoded' \
               --header 'Authorization: Bearer $SOURCEFORGE_BEARER' \
               --data-urlencode 'labels=release' \
               --data-urlencode 'state=draft' \
               --data-urlencode 'text=$RELEASE_BODY' \
               --data-urlencode 'title=$RELEASE_NAME'
